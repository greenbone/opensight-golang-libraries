# openSearchQuery Package Documentation

Package openSearchQuery provides a query builder for OpenSearch.

Usage example:

```go
q := openSearchQuery.NewBoolQueryBuilder(&openSearchQuery.QuerySettings{ /* ... */ })

if err := q.AddFilterRequest(filterRequest); err != nil {
    return nil, err
}

request, err := esquery.Search().

Query(q.Build()).
MarshalJSON()

if err != nil {
    return nil, err
}

responseBody, err := v.openSearchClient.Search(openSearchModels.VulnerabilityIndexName, request)

if err != nil {
    return nil, err
}
```

---

<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# openSearchQuery

```go
import "github.com/greenbone/opensight-golang-libraries/pkg/openSearch/openSearchQuery"
```

Package openSearchQuery provides a query builder for OpenSearch.

## Index

- [func AddBucketSortAgg\(aggs \[\]esquery.Aggregation, sortingRequest \*sorting.Request, pagingRequest \*paging.Request\) \(\[\]esquery.Aggregation, error\)](<#AddBucketSortAgg>)
- [func AddMaxAggForSorting\(aggs \[\]esquery.Aggregation, sortingRequest \*sorting.Request\) \(\[\]esquery.Aggregation, error\)](<#AddMaxAggForSorting>)
- [func AddOrder\(aggregation \*esquery.TermsAggregation, sortingRequest \*sorting.Request\) \(\*esquery.TermsAggregation, error\)](<#AddOrder>)
- [func BucketSortAgg\(sortingRequest \*sorting.Request, pagingRequest \*paging.Request\) \(\*esquery.CustomAggMap, error\)](<#BucketSortAgg>)
- [func HandleCompareOperatorBeginsWith\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorBeginsWith>)
- [func HandleCompareOperatorContains\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorContains>)
- [func HandleCompareOperatorIsEqualTo\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsEqualTo>)
- [func HandleCompareOperatorIsGreaterThan\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsGreaterThan>)
- [func HandleCompareOperatorIsGreaterThanOrEqualTo\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsGreaterThanOrEqualTo>)
- [func HandleCompareOperatorIsKeywordEqualTo\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsKeywordEqualTo>)
- [func HandleCompareOperatorIsLessThan\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsLessThan>)
- [func HandleCompareOperatorIsLessThanOrEqualTo\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsLessThanOrEqualTo>)
- [func HandleCompareOperatorNotBeginsWith\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorNotBeginsWith>)
- [type BoolQueryBuilder](<#BoolQueryBuilder>)
  - [func NewBoolQueryBuilder\(querySettings \*QuerySettings\) \*BoolQueryBuilder](<#NewBoolQueryBuilder>)
  - [func NewBoolQueryBuilderWith\(query \*esquery.BoolQuery, querySettings \*QuerySettings\) \*BoolQueryBuilder](<#NewBoolQueryBuilderWith>)
  - [func \(q \*BoolQueryBuilder\) AddCompareOperators\(operators ...CompareOperator\) \*BoolQueryBuilder](<#BoolQueryBuilder.AddCompareOperators>)
  - [func \(q \*BoolQueryBuilder\) AddFilterRequest\(request \*filter.Request\) error](<#BoolQueryBuilder.AddFilterRequest>)
  - [func \(q \*BoolQueryBuilder\) AddTermFilter\(fieldName string, value interface\{\}\) \*BoolQueryBuilder](<#BoolQueryBuilder.AddTermFilter>)
  - [func \(q \*BoolQueryBuilder\) AddTermsFilter\(fieldName string, values ...interface\{\}\) \*BoolQueryBuilder](<#BoolQueryBuilder.AddTermsFilter>)
  - [func \(q \*BoolQueryBuilder\) Build\(\) \*esquery.BoolQuery](<#BoolQueryBuilder.Build>)
  - [func \(q \*BoolQueryBuilder\) ReplaceCompareOperators\(operators \[\]CompareOperator\) \*BoolQueryBuilder](<#BoolQueryBuilder.ReplaceCompareOperators>)
- [type CompareOperator](<#CompareOperator>)
- [type CompareOperatorHandler](<#CompareOperatorHandler>)
- [type NestedQueryFieldDefinition](<#NestedQueryFieldDefinition>)
- [type QuerySettings](<#QuerySettings>)


<a name="AddBucketSortAgg"></a>
## func [AddBucketSortAgg](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/sort.go#L114-L116>)

```go
func AddBucketSortAgg(aggs []esquery.Aggregation, sortingRequest *sorting.Request, pagingRequest *paging.Request) ([]esquery.Aggregation, error)
```



<a name="AddMaxAggForSorting"></a>
## func [AddMaxAggForSorting](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/sort.go#L56>)

```go
func AddMaxAggForSorting(aggs []esquery.Aggregation, sortingRequest *sorting.Request) ([]esquery.Aggregation, error)
```



<a name="AddOrder"></a>
## func [AddOrder](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/sort.go#L45>)

```go
func AddOrder(aggregation *esquery.TermsAggregation, sortingRequest *sorting.Request) (*esquery.TermsAggregation, error)
```



<a name="BucketSortAgg"></a>
## func [BucketSortAgg](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/sort.go#L76>)

```go
func BucketSortAgg(sortingRequest *sorting.Request, pagingRequest *paging.Request) (*esquery.CustomAggMap, error)
```

BucketSortAgg is capable to sort all existing buckets, but is currently only used for paging

<a name="HandleCompareOperatorBeginsWith"></a>
## func [HandleCompareOperatorBeginsWith](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/compareHandler.go#L80>)

```go
func HandleCompareOperatorBeginsWith(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorBeginsWith handles begins with

<a name="HandleCompareOperatorContains"></a>
## func [HandleCompareOperatorContains](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/compareHandler.go#L28>)

```go
func HandleCompareOperatorContains(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorContains handles contains

<a name="HandleCompareOperatorIsEqualTo"></a>
## func [HandleCompareOperatorIsEqualTo](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/compareHandler.go#L18>)

```go
func HandleCompareOperatorIsEqualTo(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsEqualTo handles is equal to

<a name="HandleCompareOperatorIsGreaterThan"></a>
## func [HandleCompareOperatorIsGreaterThan](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/compareHandler.go#L138>)

```go
func HandleCompareOperatorIsGreaterThan(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsGreaterThan handles is greater than

<a name="HandleCompareOperatorIsGreaterThanOrEqualTo"></a>
## func [HandleCompareOperatorIsGreaterThanOrEqualTo](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/compareHandler.go#L130-L132>)

```go
func HandleCompareOperatorIsGreaterThanOrEqualTo(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsGreaterThanOrEqualTo handles is greater than or equal to

<a name="HandleCompareOperatorIsKeywordEqualTo"></a>
## func [HandleCompareOperatorIsKeywordEqualTo](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/compareHandler.go#L23>)

```go
func HandleCompareOperatorIsKeywordEqualTo(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsKeywordEqualTo handles is keyword field equal to

<a name="HandleCompareOperatorIsLessThan"></a>
## func [HandleCompareOperatorIsLessThan](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/compareHandler.go#L144>)

```go
func HandleCompareOperatorIsLessThan(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsLessThan handles is less than

<a name="HandleCompareOperatorIsLessThanOrEqualTo"></a>
## func [HandleCompareOperatorIsLessThanOrEqualTo](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/compareHandler.go#L124>)

```go
func HandleCompareOperatorIsLessThanOrEqualTo(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsLessThanOrEqualTo handles is less than or equal to

<a name="HandleCompareOperatorNotBeginsWith"></a>
## func [HandleCompareOperatorNotBeginsWith](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/compareHandler.go#L109>)

```go
func HandleCompareOperatorNotBeginsWith(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorNotBeginsWith handles not begins with

<a name="BoolQueryBuilder"></a>
## type [BoolQueryBuilder](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L16-L22>)

BoolQueryBuilder is a builder for an OpenSearch bool query. Use NewBoolQueryBuilder or NewBoolQueryBuilderWith for proper initialization.

```go
type BoolQueryBuilder struct {
    Must    []esquery.Mappable
    MustNot []esquery.Mappable
    // contains filtered or unexported fields
}
```

<a name="NewBoolQueryBuilder"></a>
### func [NewBoolQueryBuilder](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L73>)

```go
func NewBoolQueryBuilder(querySettings *QuerySettings) *BoolQueryBuilder
```

NewBoolQueryBuilder creates a new BoolQueryBuilder and returns it. It uses the default set of CompareOperator.

querySettings is used to configure the query builder.

<a name="NewBoolQueryBuilderWith"></a>
### func [NewBoolQueryBuilderWith](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L81>)

```go
func NewBoolQueryBuilderWith(query *esquery.BoolQuery, querySettings *QuerySettings) *BoolQueryBuilder
```

NewBoolQueryBuilderWith creates a new BoolQueryBuilder and returns it. It uses the default set of CompareOperator.

query is the initial bool query to use. querySettings is used to configure the query builder.

<a name="BoolQueryBuilder.AddCompareOperators"></a>
### func \(\*BoolQueryBuilder\) [AddCompareOperators](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L100>)

```go
func (q *BoolQueryBuilder) AddCompareOperators(operators ...CompareOperator) *BoolQueryBuilder
```

AddCompareOperators adds the given set of CompareOperator to the set of CompareOperator to be used for this query builder.

operators is the set of CompareOperator to add.

<a name="BoolQueryBuilder.AddFilterRequest"></a>
### func \(\*BoolQueryBuilder\) [AddFilterRequest](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L154>)

```go
func (q *BoolQueryBuilder) AddFilterRequest(request *filter.Request) error
```

AddFilterRequest adds a filter request to this query. The filter request is translated into a bool query.

<a name="BoolQueryBuilder.AddTermFilter"></a>
### func \(\*BoolQueryBuilder\) [AddTermFilter](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L116>)

```go
func (q *BoolQueryBuilder) AddTermFilter(fieldName string, value interface{}) *BoolQueryBuilder
```

AddTermFilter adds a term filter to this query.

value is the value to filter for.

<a name="BoolQueryBuilder.AddTermsFilter"></a>
### func \(\*BoolQueryBuilder\) [AddTermsFilter](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L108>)

```go
func (q *BoolQueryBuilder) AddTermsFilter(fieldName string, values ...interface{}) *BoolQueryBuilder
```

AddTermsFilter adds a terms filter to this query.

values is the list of values to filter for.

<a name="BoolQueryBuilder.Build"></a>
### func \(\*BoolQueryBuilder\) [Build](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L231>)

```go
func (q *BoolQueryBuilder) Build() *esquery.BoolQuery
```

Build returns the built query.

<a name="BoolQueryBuilder.ReplaceCompareOperators"></a>
### func \(\*BoolQueryBuilder\) [ReplaceCompareOperators](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L92>)

```go
func (q *BoolQueryBuilder) ReplaceCompareOperators(operators []CompareOperator) *BoolQueryBuilder
```

ReplaceCompareOperators replaces the set of CompareOperator to be used for this query builder.

operators is the new set of CompareOperator to use.

<a name="CompareOperator"></a>
## type [CompareOperator](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L63-L68>)

CompareOperator defines a mapping between a filter.CompareOperator and a function to generate an appropriate query condition in from of a CompareOperatorHandler.

```go
type CompareOperator struct {
    Operator filter.CompareOperator
    Handler  CompareOperatorHandler
    // MustCondition defines whether the condition should be added to the must (true) or must_not clause (false).
    MustCondition bool
}
```

<a name="CompareOperatorHandler"></a>
## type [CompareOperatorHandler](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L32-L33>)

CompareOperatorHandler is a function that generates an appropriate query condition for the given field.

fieldName is the name of the field. fieldKeys is a list of keys used only for nested fields. fieldValue is the value to compare against. querySettings are the settings to use for the query defining which fields are to be treated e.g. as wildcard array or keyword field.

```go
type CompareOperatorHandler func(fieldName string, fieldKeys []string, fieldValue any,
    querySettings *QuerySettings) esquery.Mappable
```

<a name="NestedQueryFieldDefinition"></a>
## type [NestedQueryFieldDefinition](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L52-L59>)

NestedQueryFieldDefinition is a definition of a nested query field.

```go
type NestedQueryFieldDefinition struct {
    // FieldName is the name of the field.
    FieldName string
    // FieldKeyName is the name of the key field.
    FieldKeyName string
    // FieldValueName is the name of the value field.
    FieldValueName string
}
```

<a name="QuerySettings"></a>
## type [QuerySettings](<https://github.com/greenbone/opensight-golang-libraries/blob/main/pkg/openSearch/openSearchQuery/boolQueryBuilder.go#L37-L49>)

QuerySettings is used to configure the query builder.

```go
type QuerySettings struct {
    // WildcardArrays is a map of field names to a boolean value indicating whether the field is to be treated as a wildcard array.
    WildcardArrays map[string]bool
    // IsEqualToKeywordFields is a map of field names to a boolean value indicating whether the field is to be treated as a keyword field.
    IsEqualToKeywordFields map[string]bool
    // UseNestedMatchQueryFields is a map of field names to a boolean value indicating whether the field is to be treated as a nested query field.
    UseNestedMatchQueryFields map[string]bool
    // NestedQueryFieldDefinitions is a list of nested query field definitions.
    NestedQueryFieldDefinitions []NestedQueryFieldDefinition
    // UseMatchPhraseFields is a map of field names to a boolean value indicating whether the field should use a match phrase query.
    UseMatchPhrase     map[string]bool
    FilterFieldMapping map[string]string
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->

# License

Copyright (C) 2022-2023 [Greenbone AG][Greenbone AG]

Licensed under the [GNU General Public License v3.0 or later](../../../LICENSE).