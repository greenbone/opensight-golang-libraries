# openSearchQuery Package Documentation

Package openSearchQuery provides a query builder for OpenSearch.

Usage example:

```go
q := openSearchQuery.NewBoolQueryBuilder(&openSearchQuery.QuerySettings{ /* ... */ })

if err := q.AddFilterRequest(filterRequest); err != nil {
    return nil, err
}

request, err := esquery.Search().

Query(q.Build()).
MarshalJSON()

if err != nil {
    return nil, err
}

responseBody, err := v.openSearchClient.Search(openSearchModels.VulnerabilityIndexName, request)

if err != nil {
    return nil, err
}
```

---

<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# openSearchQuery

```go
import "github.com/greenbone/opensight-golang-libraries/pkg/openSearch/openSearchQuery"
```

Package openSearchQuery provides a query builder for OpenSearch.

## Index

- [func AddBucketSortAgg\(aggs \[\]esquery.Aggregation, sortingRequest \*sorting.Request, sortFieldMapping map\[string\]EffectiveSortField, pagingRequest \*paging.Request\) \(\[\]esquery.Aggregation, error\)](<#AddBucketSortAgg>)
- [func AddMaxAggForSorting\(aggs \[\]esquery.Aggregation, sortingRequest \*sorting.Request, sortFieldMapping map\[string\]EffectiveSortField\) \(\[\]esquery.Aggregation, error\)](<#AddMaxAggForSorting>)
- [func AddOrder\(aggregation \*esquery.TermsAggregation, sortingRequest \*sorting.Request, sortFieldMapping map\[string\]EffectiveSortField\) \(\*esquery.TermsAggregation, error\)](<#AddOrder>)
- [func BucketSortAgg\(sortingRequest \*sorting.Request, sortFieldMapping map\[string\]EffectiveSortField, pagingRequest \*paging.Request\) \(\*esquery.CustomAggMap, error\)](<#BucketSortAgg>)
- [func HandleCompareOperatorBeginsWith\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorBeginsWith>)
- [func HandleCompareOperatorBetweenDates\(fieldName string, \_ \[\]string, fieldValue any, \_ \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorBetweenDates>)
- [func HandleCompareOperatorContains\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorContains>)
- [func HandleCompareOperatorExists\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorExists>)
- [func HandleCompareOperatorIsEqualTo\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsEqualTo>)
- [func HandleCompareOperatorIsEqualToRating\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsEqualToRating>)
- [func HandleCompareOperatorIsGreaterThan\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsGreaterThan>)
- [func HandleCompareOperatorIsGreaterThanOrEqualTo\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsGreaterThanOrEqualTo>)
- [func HandleCompareOperatorIsGreaterThanOrEqualToRating\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsGreaterThanOrEqualToRating>)
- [func HandleCompareOperatorIsGreaterThanRating\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsGreaterThanRating>)
- [func HandleCompareOperatorIsKeywordEqualTo\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsKeywordEqualTo>)
- [func HandleCompareOperatorIsLessThan\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsLessThan>)
- [func HandleCompareOperatorIsLessThanOrEqualTo\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsLessThanOrEqualTo>)
- [func HandleCompareOperatorIsLessThanOrEqualToRating\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsLessThanOrEqualToRating>)
- [func HandleCompareOperatorIsLessThanRating\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsLessThanRating>)
- [func HandleCompareOperatorIsNotEqualToRating\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorIsNotEqualToRating>)
- [func HandleCompareOperatorNotBeginsWith\(fieldName string, fieldKeys \[\]string, fieldValue any, querySettings \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorNotBeginsWith>)
- [func HandleCompareOperatorTextContains\(fieldName string, \_ \[\]string, fieldValue any, \_ \*QuerySettings\) esquery.Mappable](<#HandleCompareOperatorTextContains>)
- [func ValueToString\(value interface\{\}\) string](<#ValueToString>)
- [type BoolQueryBuilder](<#BoolQueryBuilder>)
  - [func NewBoolQueryBuilder\(querySettings \*QuerySettings\) \*BoolQueryBuilder](<#NewBoolQueryBuilder>)
  - [func NewBoolQueryBuilderWith\(query \*esquery.BoolQuery, querySettings \*QuerySettings\) \*BoolQueryBuilder](<#NewBoolQueryBuilderWith>)
  - [func \(q \*BoolQueryBuilder\) AddCompareOperators\(operators ...CompareOperator\) \*BoolQueryBuilder](<#BoolQueryBuilder.AddCompareOperators>)
  - [func \(q \*BoolQueryBuilder\) AddFilterRequest\(request \*filter.Request\) error](<#BoolQueryBuilder.AddFilterRequest>)
  - [func \(q \*BoolQueryBuilder\) AddTermFilter\(fieldName string, value interface\{\}\) \*BoolQueryBuilder](<#BoolQueryBuilder.AddTermFilter>)
  - [func \(q \*BoolQueryBuilder\) AddTermsFilter\(fieldName string, values ...interface\{\}\) \*BoolQueryBuilder](<#BoolQueryBuilder.AddTermsFilter>)
  - [func \(q \*BoolQueryBuilder\) Build\(\) \*esquery.BoolQuery](<#BoolQueryBuilder.Build>)
  - [func \(q \*BoolQueryBuilder\) ReplaceCompareOperators\(operators \[\]CompareOperator\) \*BoolQueryBuilder](<#BoolQueryBuilder.ReplaceCompareOperators>)
- [type CompareOperator](<#CompareOperator>)
- [type CompareOperatorHandler](<#CompareOperatorHandler>)
- [type EffectiveSortField](<#EffectiveSortField>)
- [type NestedQueryFieldDefinition](<#NestedQueryFieldDefinition>)
- [type QuerySettings](<#QuerySettings>)
- [type RatingRange](<#RatingRange>)


<a name="AddBucketSortAgg"></a>
## func AddBucketSortAgg

```go
func AddBucketSortAgg(aggs []esquery.Aggregation, sortingRequest *sorting.Request, sortFieldMapping map[string]EffectiveSortField, pagingRequest *paging.Request) ([]esquery.Aggregation, error)
```



<a name="AddMaxAggForSorting"></a>
## func AddMaxAggForSorting

```go
func AddMaxAggForSorting(aggs []esquery.Aggregation, sortingRequest *sorting.Request, sortFieldMapping map[string]EffectiveSortField) ([]esquery.Aggregation, error)
```



<a name="AddOrder"></a>
## func AddOrder

```go
func AddOrder(aggregation *esquery.TermsAggregation, sortingRequest *sorting.Request, sortFieldMapping map[string]EffectiveSortField) (*esquery.TermsAggregation, error)
```



<a name="BucketSortAgg"></a>
## func BucketSortAgg

```go
func BucketSortAgg(sortingRequest *sorting.Request, sortFieldMapping map[string]EffectiveSortField, pagingRequest *paging.Request) (*esquery.CustomAggMap, error)
```

BucketSortAgg is capable to sort all existing buckets, but is currently only used for paging

<a name="HandleCompareOperatorBeginsWith"></a>
## func HandleCompareOperatorBeginsWith

```go
func HandleCompareOperatorBeginsWith(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorBeginsWith handles begins with

<a name="HandleCompareOperatorBetweenDates"></a>
## func HandleCompareOperatorBetweenDates

```go
func HandleCompareOperatorBetweenDates(fieldName string, _ []string, fieldValue any, _ *QuerySettings) esquery.Mappable
```

HandleCompareOperatorBetweenDates constructs an OpenSearch range query for a given date field. It accepts a field name and a field value, which must be either: \- A slice of two time.Time values \(\[\]time.Time\), representing the start and end of the range, or \- A slice of two RFC3339Nano\-formatted strings \(\[\]string\), which are parsed into time.Time, representing the start and end of the range.

The generated range query is inclusive of both the lower and upper bounds. If a documentâ€™s timestamp is exactly equal to the start or end date, it will still match the query.

If the slice length is not exactly 2, or if the string values cannot be parsed into valid dates, the function logs an error and returns an empty query \(MatchNone\).

<a name="HandleCompareOperatorContains"></a>
## func HandleCompareOperatorContains

```go
func HandleCompareOperatorContains(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorContains handles contains. In the index mapping the given field must be a string of type \`keyword\`.

<a name="HandleCompareOperatorExists"></a>
## func HandleCompareOperatorExists

```go
func HandleCompareOperatorExists(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```



<a name="HandleCompareOperatorIsEqualTo"></a>
## func HandleCompareOperatorIsEqualTo

```go
func HandleCompareOperatorIsEqualTo(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsEqualTo handles is equal to

<a name="HandleCompareOperatorIsEqualToRating"></a>
## func HandleCompareOperatorIsEqualToRating

```go
func HandleCompareOperatorIsEqualToRating(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```



<a name="HandleCompareOperatorIsGreaterThan"></a>
## func HandleCompareOperatorIsGreaterThan

```go
func HandleCompareOperatorIsGreaterThan(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsGreaterThan handles is greater than

<a name="HandleCompareOperatorIsGreaterThanOrEqualTo"></a>
## func HandleCompareOperatorIsGreaterThanOrEqualTo

```go
func HandleCompareOperatorIsGreaterThanOrEqualTo(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsGreaterThanOrEqualTo handles is greater than or equal to

<a name="HandleCompareOperatorIsGreaterThanOrEqualToRating"></a>
## func HandleCompareOperatorIsGreaterThanOrEqualToRating

```go
func HandleCompareOperatorIsGreaterThanOrEqualToRating(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```



<a name="HandleCompareOperatorIsGreaterThanRating"></a>
## func HandleCompareOperatorIsGreaterThanRating

```go
func HandleCompareOperatorIsGreaterThanRating(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```



<a name="HandleCompareOperatorIsKeywordEqualTo"></a>
## func HandleCompareOperatorIsKeywordEqualTo

```go
func HandleCompareOperatorIsKeywordEqualTo(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsKeywordEqualTo handles is keyword field equal to

<a name="HandleCompareOperatorIsLessThan"></a>
## func HandleCompareOperatorIsLessThan

```go
func HandleCompareOperatorIsLessThan(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsLessThan handles is less than

<a name="HandleCompareOperatorIsLessThanOrEqualTo"></a>
## func HandleCompareOperatorIsLessThanOrEqualTo

```go
func HandleCompareOperatorIsLessThanOrEqualTo(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorIsLessThanOrEqualTo handles is less than or equal to

<a name="HandleCompareOperatorIsLessThanOrEqualToRating"></a>
## func HandleCompareOperatorIsLessThanOrEqualToRating

```go
func HandleCompareOperatorIsLessThanOrEqualToRating(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```



<a name="HandleCompareOperatorIsLessThanRating"></a>
## func HandleCompareOperatorIsLessThanRating

```go
func HandleCompareOperatorIsLessThanRating(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```



<a name="HandleCompareOperatorIsNotEqualToRating"></a>
## func HandleCompareOperatorIsNotEqualToRating

```go
func HandleCompareOperatorIsNotEqualToRating(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```



<a name="HandleCompareOperatorNotBeginsWith"></a>
## func HandleCompareOperatorNotBeginsWith

```go
func HandleCompareOperatorNotBeginsWith(fieldName string, fieldKeys []string, fieldValue any, querySettings *QuerySettings) esquery.Mappable
```

HandleCompareOperatorNotBeginsWith handles not begins with

<a name="HandleCompareOperatorTextContains"></a>
## func HandleCompareOperatorTextContains

```go
func HandleCompareOperatorTextContains(fieldName string, _ []string, fieldValue any, _ *QuerySettings) esquery.Mappable
```

HandleCompareOperatorTextContains performs a full text search on the given field. In the index mapping it must be a string of type \`text\`.

<a name="ValueToString"></a>
## func ValueToString

```go
func ValueToString(value interface{}) string
```

ValueToString converts the given value to a string. Compared to [fmt.Sprint](<https://pkg.go.dev/fmt/#Sprint>) it will give RFC3339 format for [time.Time](<https://pkg.go.dev/time/#Time>) value and a specific formatting of numbers.

<a name="BoolQueryBuilder"></a>
## type BoolQueryBuilder

BoolQueryBuilder is a builder for an OpenSearch bool query. Use NewBoolQueryBuilder or NewBoolQueryBuilderWith for proper initialization.

```go
type BoolQueryBuilder struct {
    Must    []esquery.Mappable
    MustNot []esquery.Mappable
    // contains filtered or unexported fields
}
```

<a name="NewBoolQueryBuilder"></a>
### func NewBoolQueryBuilder

```go
func NewBoolQueryBuilder(querySettings *QuerySettings) *BoolQueryBuilder
```

NewBoolQueryBuilder creates a new BoolQueryBuilder and returns it. It uses the default set of CompareOperator.

querySettings is used to configure the query builder.

<a name="NewBoolQueryBuilderWith"></a>
### func NewBoolQueryBuilderWith

```go
func NewBoolQueryBuilderWith(query *esquery.BoolQuery, querySettings *QuerySettings) *BoolQueryBuilder
```

NewBoolQueryBuilderWith creates a new BoolQueryBuilder and returns it. It uses the default set of CompareOperator.

query is the initial bool query to use. querySettings is used to configure the query builder.

<a name="BoolQueryBuilder.AddCompareOperators"></a>
### func \(\*BoolQueryBuilder\) AddCompareOperators

```go
func (q *BoolQueryBuilder) AddCompareOperators(operators ...CompareOperator) *BoolQueryBuilder
```

AddCompareOperators adds the given set of CompareOperator to the set of CompareOperator to be used for this query builder.

operators is the set of CompareOperator to add.

<a name="BoolQueryBuilder.AddFilterRequest"></a>
### func \(\*BoolQueryBuilder\) AddFilterRequest

```go
func (q *BoolQueryBuilder) AddFilterRequest(request *filter.Request) error
```

AddFilterRequest adds a filter request to this query. The filter request is translated into a bool query.

<a name="BoolQueryBuilder.AddTermFilter"></a>
### func \(\*BoolQueryBuilder\) AddTermFilter

```go
func (q *BoolQueryBuilder) AddTermFilter(fieldName string, value interface{}) *BoolQueryBuilder
```

AddTermFilter adds a term filter to this query.

value is the value to filter for.

<a name="BoolQueryBuilder.AddTermsFilter"></a>
### func \(\*BoolQueryBuilder\) AddTermsFilter

```go
func (q *BoolQueryBuilder) AddTermsFilter(fieldName string, values ...interface{}) *BoolQueryBuilder
```

AddTermsFilter adds a terms filter to this query.

values is the list of values to filter for.

<a name="BoolQueryBuilder.Build"></a>
### func \(\*BoolQueryBuilder\) Build

```go
func (q *BoolQueryBuilder) Build() *esquery.BoolQuery
```

Build returns the built query.

<a name="BoolQueryBuilder.ReplaceCompareOperators"></a>
### func \(\*BoolQueryBuilder\) ReplaceCompareOperators

```go
func (q *BoolQueryBuilder) ReplaceCompareOperators(operators []CompareOperator) *BoolQueryBuilder
```

ReplaceCompareOperators replaces the set of CompareOperator to be used for this query builder.

operators is the new set of CompareOperator to use.

<a name="CompareOperator"></a>
## type CompareOperator

CompareOperator defines a mapping between a filter.CompareOperator and a function to generate an appropriate query condition in from of a CompareOperatorHandler.

```go
type CompareOperator struct {
    Operator filter.CompareOperator
    Handler  CompareOperatorHandler
    // MustCondition defines whether the condition should be added to the must (true) or must_not clause (false).
    MustCondition bool
}
```

<a name="CompareOperatorHandler"></a>
## type CompareOperatorHandler

CompareOperatorHandler is a function that generates an appropriate query condition for the given field.

fieldName is the name of the field. fieldKeys is a list of keys used only for nested fields. fieldValue is the value to compare against. querySettings are the settings to use for the query defining which fields are to be treated e.g. as wildcard array or keyword field.

```go
type CompareOperatorHandler func(fieldName string, fieldKeys []string, fieldValue any,
    querySettings *QuerySettings) esquery.Mappable
```

<a name="EffectiveSortField"></a>
## type EffectiveSortField



```go
type EffectiveSortField struct {
    PlainField       *string
    AggregationName  *string
    AggregationValue string
}
```

<a name="NestedQueryFieldDefinition"></a>
## type NestedQueryFieldDefinition

NestedQueryFieldDefinition is a definition of a nested query field.

```go
type NestedQueryFieldDefinition struct {
    // FieldName is the name of the field.
    FieldName string
    // FieldKeyName is the name of the key field.
    FieldKeyName string
    // FieldValueName is the name of the value field.
    FieldValueName string
}
```

<a name="QuerySettings"></a>
## type QuerySettings

QuerySettings is used to configure the query builder.

```go
type QuerySettings struct {
    // WildcardArrays is a map of field names to a boolean value indicating whether the field is to be treated as a wildcard array.
    WildcardArrays map[string]bool
    // IsEqualToKeywordFields is a map of field names to a boolean value indicating whether the field is to be treated as a keyword field.
    IsEqualToKeywordFields map[string]bool
    // UseNestedMatchQueryFields is a map of field names to a boolean value indicating whether the field is to be treated as a nested query field.
    UseNestedMatchQueryFields map[string]bool
    // NestedQueryFieldDefinitions is a list of nested query field definitions.
    NestedQueryFieldDefinitions []NestedQueryFieldDefinition
    // UseMatchPhraseFields is a map of field names to a boolean value indicating whether the field should use a match phrase query.
    UseMatchPhrase     map[string]bool
    FilterFieldMapping map[string]string
    // StringFieldRating is a map for field names with a rating. The rating is used to determine the compare order of the field in the query.
    StringFieldRating map[string]map[string]RatingRange
}
```

<a name="RatingRange"></a>
## type RatingRange

RatingRange represent a closed interval of float32 values.

```go
type RatingRange struct {
    Min float32 // Lower bound of the rating range (inclusive)
    Max float32 // Upper bound of the rating range (inclusive)
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->

# License

Copyright (C) 2022-2023 [Greenbone AG][Greenbone AG]

Licensed under the [GNU General Public License v3.0 or later](../../../LICENSE).