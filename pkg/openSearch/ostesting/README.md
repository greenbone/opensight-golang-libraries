<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# ostesting

```go
import "github.com/greenbone/opensight-golang-libraries/pkg/openSearch/ostesting"
```

Package ostesting provides a way to conveniently test against a real openSearch instance. It is in the same fashion of https://github.com/peterldowns/pgtestdb You need to have an OpenSearch instance running that the tests can connect to.

## Index

- [Constants](<#constants>)
- [func GetDocuments\[T any\]\(t \*testing.T, tester \*Tester, index string\) \[\]T](<#GetDocuments>)
- [func GetDocumentsReturningError\[T any\]\(tester \*Tester, index string\) \(\[\]T, error\)](<#GetDocumentsReturningError>)
- [func RunNotParallelOption\(tst \*Tester\)](<#RunNotParallelOption>)
- [func ToAnySlice\[T any\]\(input \[\]T\) \[\]any](<#ToAnySlice>)
- [type ClientConfig](<#ClientConfig>)
- [type TestType](<#TestType>)
- [type Tester](<#Tester>)
  - [func NewTester\(t \*testing.T, opts ...TesterOption\) \*Tester](<#NewTester>)
  - [func \(tst Tester\) Config\(\) ClientConfig](<#Tester.Config>)
  - [func \(tst Tester\) CreateDocuments\(t \*testing.T, index string, docs \[\]any, ids \[\]string\)](<#Tester.CreateDocuments>)
  - [func \(tst Tester\) CreateDocumentsReturningError\(index string, docs \[\]any, ids \[\]string\) error](<#Tester.CreateDocumentsReturningError>)
  - [func \(tst Tester\) DeleteIndex\(t \*testing.T, index string\)](<#Tester.DeleteIndex>)
  - [func \(tst Tester\) GetTestTypeDocuments\(t \*testing.T, index string\) \[\]TestType](<#Tester.GetTestTypeDocuments>)
  - [func \(tst Tester\) NewIndex\(t \*testing.T, prefix string, mapping \*string\) string](<#Tester.NewIndex>)
  - [func \(tst Tester\) NewIndexAlias\(t \*testing.T, prefix string, mapping \*string\) \(index, alias string\)](<#Tester.NewIndexAlias>)
  - [func \(tst Tester\) NewNamedIndexAlias\(t \*testing.T, name string, mapping \*string\) string](<#Tester.NewNamedIndexAlias>)
  - [func \(tst Tester\) NewTestTypeIndex\(t \*testing.T, prefix string\) string](<#Tester.NewTestTypeIndex>)
  - [func \(tst Tester\) NewTestTypeIndexAlias\(t \*testing.T, prefix string\) \(index, alias string\)](<#Tester.NewTestTypeIndexAlias>)
  - [func \(tst Tester\) OSClient\(\) \*opensearchapi.Client](<#Tester.OSClient>)
  - [func \(tst Tester\) RefreshIndex\(t \*testing.T, index string\)](<#Tester.RefreshIndex>)
  - [func \(tst Tester\) T\(\) \*testing.T](<#Tester.T>)
- [type TesterOption](<#TesterOption>)
  - [func WithAddress\(address string\) TesterOption](<#WithAddress>)
  - [func WithConfig\(conf ClientConfig\) TesterOption](<#WithConfig>)


## Constants

<a name="KeepFailedEnv"></a>KeepFailedEnv when set keeps the environment and test data after test execution failed. This is useful for debugging failed tests.

```go
const KeepFailedEnv = "TEST_KEEP_FAILED"
```

<a name="GetDocuments"></a>
## func GetDocuments

```go
func GetDocuments[T any](t *testing.T, tester *Tester, index string) []T
```

GetDocuments returns all documents added to test index

<a name="GetDocumentsReturningError"></a>
## func GetDocumentsReturningError

```go
func GetDocumentsReturningError[T any](tester *Tester, index string) ([]T, error)
```

GetDocumentsReturningError returns all documents added to test index and returns error \(instead of failing the tests like [GetDocuments](<#GetDocuments>) or \[GetTestTypeDocuments\]\)

<a name="RunNotParallelOption"></a>
## func RunNotParallelOption

```go
func RunNotParallelOption(tst *Tester)
```

RunNotParallelOption signifies that tests associated with [Tester](<#Tester>) should not be run in parallel \(by default they are\)

<a name="ToAnySlice"></a>
## func ToAnySlice

```go
func ToAnySlice[T any](input []T) []any
```

ToAnySlice converts a slice of any type to a slice of \[\]any. Useful when passing documents to [Tester.CreateDocuments](<#Tester.CreateDocuments>).

<a name="ClientConfig"></a>
## type ClientConfig



```go
type ClientConfig struct {
    Address  string
    User     string
    Password string
}
```

<a name="TestType"></a>
## type TestType

TestType can be used as generic document object for testing

```go
type TestType struct {
    ID               string    `json:"id"` // for easier identification in tests
    Text             string    `json:"text"`
    Keyword          string    `json:"keyword"`
    TextAndKeyword   string    `json:"textAndKeyword"`
    Integer          int       `json:"integer"`
    Float            float32   `json:"float"`
    Boolean          bool      `json:"boolean"`
    DateTimeStr      string    `json:"dateTimeStr,omitempty"`
    DateTime         time.Time `json:"dateTime"`
    KeywordOmitEmpty string    `json:"keywordOmitEmpty,omitempty"`
}
```

<a name="Tester"></a>
## type Tester

Tester manages connecting with testing OpenSearch instance and implements helper methods

```go
type Tester struct {
    // contains filtered or unexported fields
}
```

<a name="NewTester"></a>
### func NewTester

```go
func NewTester(t *testing.T, opts ...TesterOption) *Tester
```

NewTester initializes new Tester It runs tests associated with \[t\] as parallel by default, unless runNotParallel option is provided.

<a name="Tester.Config"></a>
### func \(Tester\) Config

```go
func (tst Tester) Config() ClientConfig
```

Config returns opensearch config that can be used to initialize client using test OpenSearch instance

<a name="Tester.CreateDocuments"></a>
### func \(Tester\) CreateDocuments

```go
func (tst Tester) CreateDocuments(t *testing.T, index string, docs []any, ids []string)
```

CreateDocuments creates documents \[docs\] on index \[index\] with IDs \[ids\]. If provided \[ids\] is nil the IDs for created documents will be generated.

<a name="Tester.CreateDocumentsReturningError"></a>
### func \(Tester\) CreateDocumentsReturningError

```go
func (tst Tester) CreateDocumentsReturningError(index string, docs []any, ids []string) error
```

CreateDocumentsReturningError creates documents \[docs\] on index \[index\] with IDs \[ids\]. If provided \[ids\] is nil the IDs for created documents will be generated. Instead of using [\\\*testing.T](<https://pkg.go.dev/testing/#T>) to fail on errors \(like CreateDocuments\) it returns error. Can be used when we expect error on creating documents in index and do not want to fail a test on it.

<a name="Tester.DeleteIndex"></a>
### func \(Tester\) DeleteIndex

```go
func (tst Tester) DeleteIndex(t *testing.T, index string)
```

DeleteIndex deletes indices with given name \(or pattern, eg. "index\-name\*"\)

<a name="Tester.GetTestTypeDocuments"></a>
### func \(Tester\) GetTestTypeDocuments

```go
func (tst Tester) GetTestTypeDocuments(t *testing.T, index string) []TestType
```

GetTestTypeDocuments returns all documents of type [TestType](<#TestType>) from \[index\]

<a name="Tester.NewIndex"></a>
### func \(Tester\) NewIndex

```go
func (tst Tester) NewIndex(t *testing.T, prefix string, mapping *string) string
```

NewIndex creates new index with unique name generated based on provided \[prefix\]. It returns the generated index name. Note: in most cases the \_IndexAlias functions should be used that create both index and add it to alias as this represents the typical usage of indices \(accessing them through alias\) in the code.

<a name="Tester.NewIndexAlias"></a>
### func \(Tester\) NewIndexAlias

```go
func (tst Tester) NewIndexAlias(t *testing.T, prefix string, mapping *string) (index, alias string)
```

NewIndexAlias creates new uniquely named index together with associated alias using mapping if not nil \(otherwise with dynamic mapping\). It also registers \[t\].Cleanup function that deletes the index after test.

\[prefix\] is the prefix name of the index that would be used to generate new unique index and alias name. Generation of unique index name is there to allow tests running in parallel and not interfere with each other.

Internally opensearchapi.Client is called directly rather than opensearch.Client, to avoid using tested object in testing setup and to not have to adjust opensearch.Client methods just for the sake of being used by Tester \(as tester use\-case of generating unique index/alias with custom mapping differs from production use\-cases\).

Upon successful creation the function returns index and associated alias names, in case of error \[t\] is used to mark test as failed. Note: usually the index should be accessed through alias name. In some cases the method needs to receive the concrete index instead.

<a name="Tester.NewNamedIndexAlias"></a>
### func \(Tester\) NewNamedIndexAlias

```go
func (tst Tester) NewNamedIndexAlias(t *testing.T, name string, mapping *string) string
```

NewNamedIndexAlias works like [Tester.NewIndexAlias](<#Tester.NewIndexAlias>), except the name of the newly created index alias will be exactly as provided with \[name\] instead of being generated based on provided prefix. On successful creation it returns the concrete underlying index name It can be used in testing functionalities that rely on defined index alias name \(eg. IndexVTS\) and for which generated index alias name would not work. It goes with a drawback of having to make sure that other test run in parallel will not use the same index alias and interfere \- while internal indices names are still unique, they would refer to the same alias.

<a name="Tester.NewTestTypeIndex"></a>
### func \(Tester\) NewTestTypeIndex

```go
func (tst Tester) NewTestTypeIndex(t *testing.T, prefix string) string
```

NewTestTypeIndex creates new index appropriate to use with \[testType\] documents with given \[prefix\] of index name. Internally it calls [Tester.NewIndex](<#Tester.NewIndex>).

<a name="Tester.NewTestTypeIndexAlias"></a>
### func \(Tester\) NewTestTypeIndexAlias

```go
func (tst Tester) NewTestTypeIndexAlias(t *testing.T, prefix string) (index, alias string)
```

NewTestTypeIndexAlias creates new index appropriate to use with \[testType\] documents with given index and alias names \[prefix\] and returns new index and alias names. Internally it calls [Tester.NewIndexAlias](<#Tester.NewIndexAlias>).

<a name="Tester.OSClient"></a>
### func \(Tester\) OSClient

```go
func (tst Tester) OSClient() *opensearchapi.Client
```

OSClient returns \[\*opensearchapi.Client\] associated with test OpenSearch instance

<a name="Tester.RefreshIndex"></a>
### func \(Tester\) RefreshIndex

```go
func (tst Tester) RefreshIndex(t *testing.T, index string)
```

RefreshIndex waits for index to refresh, so the updated documents can be obtained

<a name="Tester.T"></a>
### func \(Tester\) T

```go
func (tst Tester) T() *testing.T
```

T returns \*testing.T associated with tester

<a name="TesterOption"></a>
## type TesterOption



```go
type TesterOption func(tst *Tester)
```

<a name="WithAddress"></a>
### func WithAddress

```go
func WithAddress(address string) TesterOption
```

WithAddress sets the custom address of testing opensearch instance to which the tester should point to

<a name="WithConfig"></a>
### func WithConfig

```go
func WithConfig(conf ClientConfig) TesterOption
```

WithConfig is an option to use custom [ClientConfig](<#ClientConfig>) for tester.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->